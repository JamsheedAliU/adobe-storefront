<<<<<<< HEAD
import{jsxs as x,jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as W,classes as X}from"@dropins/tools/lib.js";import{g as Y,c as w,u as Z,T as $,F as z,B as G}from"./useInLineAlert.js";import{useState as _,useCallback as b,useEffect as q,useMemo as O}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{a as R}from"./getCustomerToken.js";import{r as tt}from"./resendConfirmationEmail.js";import{s as at,a as rt}from"./simplifyTransformAttributesForm.js";import{c as et}from"./confirmEmail.js";import{useText as H}from"@dropins/tools/i18n.js";import{InLineAlert as st,InputPassword as ot}from"@dropins/tools/components.js";import{E as it}from"./EmailConfirmationForm.js";const nt=({emailConfirmationStatusMessage:t,translations:r,initialEmailValue:o,routeSignUp:c,routeForgotPassword:u,routeRedirectOnSignIn:y,onErrorCallback:d,setActiveComponent:a,onSuccessCallback:f,onSignUpLinkClick:l,handleSetInLineAlertProps:e,routeRedirectOnEmailConfirmationClose:E})=>{const[M,S]=_(""),[h,I]=_(!1),[g,F]=_(""),[A,T]=_(!1),[L,p]=_({userName:"",status:!1}),[k,N]=_(!1),P=b(async i=>{await tt(i),I(!0),e({})},[e]);q(()=>{t!=null&&t.text&&e({text:t.text,type:t.status?t.status:void 0})},[t,e]);const C=b(i=>r?x("span",{className:"auth-signInForm__resend-email-notification",children:[r.resendEmailInformationText," ",n("button",{onClick:()=>P(i),children:r.resendEmailButtonText})," ",r.resendEmailAdditionalText]}):"",[P,r]),B=b(async i=>{var K;e({}),N(!0);const m=Y(i.target);if(m.password||(T(!0),N(!1)),m!=null&&m.email&&(m!=null&&m.password)){const{email:D,password:Q}=m,s=await R({email:D,password:Q,handleSetInLineAlertProps:e,onErrorCallback:d,translations:r});if((K=s==null?void 0:s.errorMessage)!=null&&K.length){S(D);const V=s.errorMessage.includes("This account isn't confirmed. Verify and try again.")?C(D):s.errorMessage;e({text:V,type:"error"}),F("")}s!=null&&s.userName&&(i.target.reset(),w(y)?window.location.href=y():(f==null||f({userName:s==null?void 0:s.userName,status:!0}),p({userName:s==null?void 0:s.userName,status:!0}))),T(!1)}N(!1),F("")},[C,e,r,d,y,f]),U=b(()=>{if(w(a)){a("resetPasswordForm");return}w(u)&&(window.location.href=u())},[u,a]),v=b(()=>{if(w(l)&&l(),w(a)){a("signUpForm");return}w(c)&&(window.location.href=c())},[l,c,a]),j=O(()=>{const i=at(rt);return o!=null&&o.length?i==null?void 0:i.map(m=>({...m,defaultValue:o})):i},[o]),J=b(()=>{e({}),w(E)?window.location.href=E():I(!1)},[e,E]);return{userEmail:M,defaultEnhancedEmailFields:j,passwordError:A,isSuccessful:L,isLoading:k,signInPasswordValue:g,showEmailConfirmationForm:h,setShowEmailConfirmationForm:I,setSignInPasswordValue:F,submitLogInUser:B,forgotPasswordCallback:U,onSignUpLinkClickCallback:v,handledOnPrimaryButtonClick:J}},mt=()=>{let t=new URL(window.location.href),r=t.searchParams.get("email"),o=t.searchParams.get("key");r&&o&&(t.searchParams.delete("email"),t.searchParams.delete("key"),window.history.replaceState({},document.title,t.toString()))},ct=({enableEmailConfirmation:t})=>{const r=H({accountConfirmMessage:"Auth.EmailConfirmationForm.accountConfirmMessage",accountConfirmationEmailSuccessMessage:"Auth.EmailConfirmationForm.accountConfirmationEmailSuccessMessage"}),[o,c]=_({text:"",status:""});return q(()=>{if(t){const{search:u}=window.location;u.includes("email=")&&u.includes("key=")&&(async()=>{var f,l,e;const d=new URLSearchParams(u),a=await et({customerEmail:d.get("email"),customerConfirmationKey:d.get("key")});if(!a)return null;(f=a==null?void 0:a.errors)!=null&&f.length?c({text:a==null?void 0:a.errors[0].message,status:"error"}):(c({text:a.data.confirmEmail.customer.email?r.accountConfirmationEmailSuccessMessage.replace("{email}",(e=(l=a==null?void 0:a.data)==null?void 0:l.confirmEmail.customer)==null?void 0:e.email):r.accountConfirmMessage,status:"success"}),mt())})()}},[t,r]),{emailConfirmationStatusMessage:o}},Nt=({slots:t,formSize:r="default",initialEmailValue:o="",renderSignUpLink:c=!1,enableEmailConfirmation:u=!1,hideCloseBtnOnEmailConfirmation:y=!1,routeRedirectOnEmailConfirmationClose:d,routeRedirectOnSignIn:a,routeForgotPassword:f,routeSignUp:l,onSuccessCallback:e,setActiveComponent:E,onErrorCallback:M,onSignUpLinkClick:S})=>{const h=H({title:"Auth.SignInForm.title",buttonPrimary:"Auth.SignInForm.buttonPrimary",buttonSecondary:"Auth.SignInForm.buttonSecondary",buttonTertiary:"Auth.SignInForm.buttonTertiary",resendEmailInformationText:"Auth.Notification.resendEmailNotification.informationText",resendEmailButtonText:"Auth.Notification.resendEmailNotification.buttonText",resendEmailAdditionalText:"Auth.Notification.resendEmailNotification.additionalText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage"}),{emailConfirmationStatusMessage:I}=ct({enableEmailConfirmation:u}),{inLineAlertProps:g,handleSetInLineAlertProps:F}=Z(),{userEmail:A,defaultEnhancedEmailFields:T,passwordError:L,isSuccessful:p,isLoading:k,signInPasswordValue:N,showEmailConfirmationForm:P,setSignInPasswordValue:C,submitLogInUser:B,forgotPasswordCallback:U,onSignUpLinkClickCallback:v,handledOnPrimaryButtonClick:j}=nt({translations:h,emailConfirmationStatusMessage:I,initialEmailValue:o,routeSignUp:l,routeForgotPassword:f,routeRedirectOnSignIn:a,setActiveComponent:E,onErrorCallback:M,onSuccessCallback:e,onSignUpLinkClick:S,handleSetInLineAlertProps:F,routeRedirectOnEmailConfirmationClose:d});return p.status&&(t!=null&&t.SuccessNotification)?n(W,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:t==null?void 0:t.SuccessNotification,context:{isSuccessful:p}}):P?n(it,{formSize:r,userEmail:A,inLineAlertProps:g,hideCloseBtnOnEmailConfirmation:y,handleSetInLineAlertProps:F,onPrimaryButtonClick:j}):x("div",{className:X(["auth-signInForm",r]),"data-testid":"signInForm",children:[n($,{text:h.title,bottomLine:!1,className:"auth-signInForm__title"}),g.text?n(st,{"data-testid":"authInLineAlert",className:"auth-signInForm__notification",type:g.type,variant:"secondary",heading:g.text,icon:g.icon}):null,x(z,{name:"signIn_form",className:"auth-signInForm__form",submitCallback:B,isLoading:k,fieldsConfig:T,children:[n(ot,{className:"auth-signInForm__form__password",autoComplete:"current-password",error:L,defaultValue:N,onValue:C,hideStatusIndicator:!0}),x("div",{className:"auth-signInForm__form__buttons",children:[x("div",{className:"auth-signInForm__form__buttons--combine",children:[n(G,{type:"button",variant:"tertiary",style:{padding:0},buttonText:h.buttonTertiary,className:"auth-signInForm__button auth-signInForm__button--forgot",enableLoader:!1,onClick:U,"data-testid":"switchToSignUp"}),c?n("span",{}):null,c?n(G,{type:"button",variant:"tertiary",style:{padding:0},buttonText:h.buttonSecondary,className:"auth-signInForm__button auth-signInForm__button--signup",enableLoader:!1,onClick:v}):null]}),n(G,{type:"submit",buttonText:h.buttonPrimary,variant:"primary",className:"auth-signInForm__button auth-signInForm__button--submit",enableLoader:k})]})]}),n("div",{id:"generateCustomerToken"})]})};export{Nt as S};
=======
import{jsx as u,jsxs as k}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as $,classes as z}from"@dropins/tools/lib.js";import{g as V,c as F,u as O,T as R,F as tt,B as q}from"./useInLineAlert.js";import{useState as g,useCallback as E,useEffect as Q,useMemo as at}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{a as rt}from"./getCustomerToken.js";import{r as ot}from"./resendConfirmationEmail.js";import{s as st,a as et}from"./simplifyTransformAttributesForm.js";import{c as it}from"./confirmEmail.js";import{useText as W}from"@dropins/tools/i18n.js";import{InLineAlert as nt,InputPassword as mt}from"@dropins/tools/components.js";import{E as ct}from"./EmailConfirmationForm.js";const ut=({emailConfirmationStatusMessage:t,translations:r,initialEmailValue:e,routeSignUp:d,routeForgotPassword:m,routeRedirectOnSignIn:_,onErrorCallback:w,setActiveComponent:a,onSuccessCallback:f,onSignUpLinkClick:h,handleSetInLineAlertProps:o,routeRedirectOnEmailConfirmationClose:b})=>{const[A,P]=g(""),[L,n]=g(!1),[C,l]=g(""),[T,y]=g(!1),[M,S]=g({userName:"",status:!1}),[B,I]=g(!1),[x,N]=g([]),p=E(async i=>{o(),n(!0),y(!1),N([]),await ot(i)},[o]),U=E(i=>{i.length?y(!1):y(!0),l(i)},[]);Q(()=>{t!=null&&t.text&&o({text:t.text,type:t.status?t.status:void 0})},[t,o]);const v=E(async i=>{var H;o(),I(!0);const c=V(i.target);if(c.password||(y(!0),I(!1)),c!=null&&c.email&&(c!=null&&c.password)){const{email:K,password:Y}=c,s=await rt({email:K,password:Y,handleSetInLineAlertProps:o,onErrorCallback:w,translations:r});if((H=s==null?void 0:s.errorMessage)!=null&&H.length){P(K);const J=s.errorMessage.includes("This account isn't confirmed. Verify and try again."),Z=J?r.resendEmailInformationText:s.errorMessage;N(J?[{label:r.resendEmailButtonText,onClick:()=>{p(K)}}]:[]),o({text:Z,type:"error"}),l("")}s!=null&&s.userName&&(i.target.reset(),F(_)?window.location.href=_():(f==null||f({userName:s==null?void 0:s.userName,status:!0}),S({userName:s==null?void 0:s.userName,status:!0}))),y(!1)}I(!1)},[o,w,r,p,_,f]),j=E(()=>{if(F(a)){a("resetPasswordForm");return}F(m)&&(window.location.href=m())},[m,a]),D=E(()=>{if(F(h)&&h(),F(a)){a("signUpForm");return}F(d)&&(window.location.href=d())},[h,d,a]),G=at(()=>{const i=st(et);return e!=null&&e.length?i==null?void 0:i.map(c=>({...c,defaultValue:e})):i},[e]),X=E(()=>{o(),F(b)?window.location.href=b():n(!1)},[o,b]);return{additionalActionsAlert:x,userEmail:A,defaultEnhancedEmailFields:G,passwordError:T,isSuccessful:M,isLoading:B,signInPasswordValue:C,showEmailConfirmationForm:L,setShowEmailConfirmationForm:n,setSignInPasswordValue:l,submitLogInUser:v,forgotPasswordCallback:j,onSignUpLinkClickCallback:D,handledOnPrimaryButtonClick:X,handleSetPassword:U}},ft=()=>{let t=new URL(window.location.href),r=t.searchParams.get("email"),e=t.searchParams.get("key");r&&e&&(t.searchParams.delete("email"),t.searchParams.delete("key"),window.history.replaceState({},document.title,t.toString()))},lt=({enableEmailConfirmation:t})=>{const r=W({accountConfirmMessage:"Auth.EmailConfirmationForm.accountConfirmMessage",accountConfirmationEmailSuccessMessage:"Auth.EmailConfirmationForm.accountConfirmationEmailSuccessMessage"}),[e,d]=g({text:"",status:""});return Q(()=>{if(t){const{search:m}=window.location;m.includes("email=")&&m.includes("key=")&&(async()=>{var f,h,o;const w=new URLSearchParams(m),a=await it({customerEmail:w.get("email"),customerConfirmationKey:w.get("key")});if(!a)return null;(f=a==null?void 0:a.errors)!=null&&f.length?d({text:a==null?void 0:a.errors[0].message,status:"error"}):(d({text:a.data.confirmEmail.customer.email?r.accountConfirmationEmailSuccessMessage.replace("{email}",(o=(h=a==null?void 0:a.data)==null?void 0:h.confirmEmail.customer)==null?void 0:o.email):r.accountConfirmMessage,status:"success"}),ft())})()}},[t,r]),{emailConfirmationStatusMessage:e}},pt=({slots:t,labels:r,formSize:e="default",initialEmailValue:d="",renderSignUpLink:m=!1,enableEmailConfirmation:_=!1,hideCloseBtnOnEmailConfirmation:w=!1,routeRedirectOnEmailConfirmationClose:a,routeRedirectOnSignIn:f,routeForgotPassword:h,routeSignUp:o,onSuccessCallback:b,setActiveComponent:A,onErrorCallback:P,onSignUpLinkClick:L})=>{const n=W({title:"Auth.SignInForm.title",buttonPrimary:"Auth.SignInForm.buttonPrimary",buttonSecondary:"Auth.SignInForm.buttonSecondary",buttonTertiary:"Auth.SignInForm.buttonTertiary",resendEmailInformationText:"Auth.Notification.resendEmailNotification.informationText",resendEmailButtonText:"Auth.Notification.resendEmailNotification.buttonText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel"}),{emailConfirmationStatusMessage:C}=lt({enableEmailConfirmation:_}),{inLineAlertProps:l,handleSetInLineAlertProps:T}=O(),{userEmail:y,additionalActionsAlert:M,defaultEnhancedEmailFields:S,passwordError:B,isSuccessful:I,isLoading:x,signInPasswordValue:N,showEmailConfirmationForm:p,submitLogInUser:U,forgotPasswordCallback:v,onSignUpLinkClickCallback:j,handledOnPrimaryButtonClick:D,handleSetPassword:G}=ut({translations:n,emailConfirmationStatusMessage:C,initialEmailValue:d,routeSignUp:o,routeForgotPassword:h,routeRedirectOnSignIn:f,setActiveComponent:A,onErrorCallback:P,onSuccessCallback:b,onSignUpLinkClick:L,handleSetInLineAlertProps:T,routeRedirectOnEmailConfirmationClose:a});return I.status&&(t!=null&&t.SuccessNotification)?u($,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:t==null?void 0:t.SuccessNotification,context:{isSuccessful:I}}):p?u(ct,{formSize:e,userEmail:y,inLineAlertProps:l,hideCloseBtnOnEmailConfirmation:w,handleSetInLineAlertProps:T,onPrimaryButtonClick:D}):k("div",{className:z(["auth-signInForm",e]),"data-testid":"signInForm",children:[u(R,{text:(r==null?void 0:r.formTitleText)??n.title,bottomLine:!1,className:"auth-signInForm__title"}),l.text?u(nt,{"data-testid":"authInLineAlert",className:"auth-signInForm__notification",type:l.type,variant:"secondary",heading:l.text,icon:l.icon,additionalActions:M}):null,k(tt,{name:"signIn_form",className:"auth-signInForm__form",submitCallback:U,isLoading:x,fieldsConfig:S,children:[u(mt,{hideStatusIndicator:!0,className:"auth-signInForm__form__password",autoComplete:"current-password",error:B,defaultValue:N,onValue:G,placeholder:n.placeholder,floatingLabel:n.floatingLabel}),k("div",{className:"auth-signInForm__form__buttons",children:[k("div",{className:"auth-signInForm__form__buttons--combine",children:[u(q,{type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonTertiary,className:"auth-signInForm__button auth-signInForm__button--forgot",enableLoader:!1,onClick:v,"data-testid":"switchToSignUp"}),m?u("span",{}):null,m?u(q,{type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonSecondary,className:"auth-signInForm__button auth-signInForm__button--signup",enableLoader:!1,onClick:j}):null]}),u(q,{type:"submit",buttonText:(r==null?void 0:r.primaryButtonText)??n.buttonPrimary,variant:"primary",className:"auth-signInForm__button auth-signInForm__button--submit",enableLoader:x})]})]}),u("div",{id:"generateCustomerToken"})]})};export{pt as S};
>>>>>>> template/main
