<<<<<<< HEAD
import{c as K,e as Q,d as J}from"../chunks/customerOrder.js";import{useState as X,useEffect as Y}from"@dropins/tools/preact-hooks.js";import{classes as v,getFormValues as rr}from"@dropins/tools/lib.js";import{jsx as r,jsxs as d,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{Icon as $,Button as B,Skeleton as w,SkeletonRow as u,Card as T,InLineAlert as er,Field as V,Input as W,Price as O,Divider as b,CartItem as nr,Image as tr,CartItemSkeleton as x}from"@dropins/tools/components.js";import*as _ from"@dropins/tools/preact-compat.js";import{useReducer as ar,useState as or,useCallback as A,useEffect as Z}from"@dropins/tools/preact-compat.js";import{Text as l,useText as P}from"@dropins/tools/i18n.js";import{events as ir}from"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";const cr=()=>{const e=()=>window.innerWidth>=1920?"xxlarge":window.innerWidth>=1366?"xlarge":window.innerWidth>=1024?"large":window.innerWidth>=768?"medium":"small",[n,a]=X(e());return Y(()=>{let i;const o=()=>{i&&clearTimeout(i),i=setTimeout(()=>a(e()),50)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),i&&clearTimeout(i)}},[]),n};var k=(e=>(e.ADD_ORDER_REFERENCE="ADD_ORDER_REFERENCE",e.LOADING="LOADING",e.SET_DETAILS="SET_DETAILS",e.ALERT="ALERT",e.DISMISS_ALERT="DISMISS_ALERT",e))(k||{}),G=(e=>(e.ERROR="error",e.WARNING="warning",e.SUCCESS="success",e))(G||{}),R=(e=>(e.INVALID_ORDER="invalid_order",e.INVALID_SEARCH="invalid_search",e.UNKNOWN="unknown_error",e))(R||{});function dr(e,n){switch(n.type){case"LOADING":return{...e,isLoading:!0};case"SET_DETAILS":return{...e,isLoading:!1,details:n.details,alert:n.alert,isOrderFromSearchForm:n.fromSearchForm||!1};case"ALERT":return{...e,isLoading:!1,alert:n.alert};case"DISMISS_ALERT":return{...e,alert:void 0};default:return e}}const U=({children:e,className:n})=>cr()!=="small"?r("div",{className:n,children:e}):r(S,{children:e});function mr(e){const n=e==null?void 0:e.total,a=e==null?void 0:e.is_virtual;if(!n)return;const i=n==null?void 0:n.grand_total,o=n==null?void 0:n.subtotal,t=n==null?void 0:n.total_shipping,m=n==null?void 0:n.total_tax;return{total:{inclTax:{amount:(i==null?void 0:i.value)||0,currency:(i==null?void 0:i.currency)||""}},subtotal:{amount:(o==null?void 0:o.value)||0,currency:(o==null?void 0:o.currency)||"",isTaxIncl:!1},shipping:{amount:(t==null?void 0:t.value)||0,currency:(t==null?void 0:t.currency)||"",isVirtual:a},tax:{amount:(m==null?void 0:m.value)||0,currency:(m==null?void 0:m.currency)||""}}}const lr=({state:e})=>{const{isLoading:n,details:a}=e,i=mr(a);return d(S,{children:[r(Er,{isLoading:n,summary:i}),r(xr,{isLoading:n,details:a})]})},sr=({state:e})=>r(U,{className:"order-confirmation__aside",children:r(lr,{state:e})}),ur=({state:e,routeHome:n,routeSupport:a,onSignUpClick:i})=>{const{details:o,isLoading:t}=e,m=o==null?void 0:o.billing_address,c=(m==null?void 0:m.firstname)||"",f=(o==null?void 0:o.number)||"",C=(o==null?void 0:o.status)||"";return d(S,{children:[(t||!t&&(!!c&&!!f))&&r(yr,{isLoading:t,customerName:c,orderNumber:f,orderStatus:C,onSignUpClick:i}),r(Or,{isLoading:t,orderDetails:o}),r(Nr,{isLoading:t,routeHome:n,routeSupport:a})]})},fr=({state:e,routeHome:n,routeSupport:a,dismissAlert:i,onOrderSearch:o,onSignUpClick:t})=>r(U,{className:"order-confirmation__main",children:r(ur,{state:e,routeHome:n,routeSupport:a,dismissAlert:i,onOrderSearch:o,onSignUpClick:t})}),hr=({className:e,state:n,dismissAlert:a,routeHome:i,routeSupport:o,onOrderSearch:t,onSignUpClick:m})=>{const{details:c,alert:f,isLoading:C}=n,y=!!(c!=null&&c.number),s=f&&f.code===R.INVALID_ORDER,h=f&&f.code===R.INVALID_SEARCH;return!C&&!y?r("div",{className:v(["order-confirmation",e]),children:r(gr,{alert:s||h?{heading:f.message,description:"",type:f.type,onDismiss:a}:void 0,onOrderSearch:t})}):d("div",{className:v(["order-confirmation",e]),children:[r(fr,{state:n,dismissAlert:a,routeHome:i,routeSupport:o,onOrderSearch:t,onSignUpClick:m}),r(sr,{state:n})]})},pr=e=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},_.createElement("g",{clipPath:"url(#clip0_4797_15077)"},_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.15 20.85L1.5 17.53V6.63L10.15 10V20.85Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.63001L10.15 3.20001L18.8 6.63001L10.15 10L1.5 6.63001Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.17969 4.77002L14.8297 8.15002V11.47",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),_.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.7896 12.64V6.63L10.1396 10V20.85L14.8296 19.05",stroke:"currentColor",strokeLinejoin:"round"}),_.createElement("path",{className:"success-icon",vectorEffect:"non-scaling-stroke",d:"M15.71 17.26C15.71 15.38 17.23 13.86 19.11 13.86C20.99 13.86 22.51 15.38 22.51 17.26C22.51 19.14 20.99 20.66 19.11 20.66C17.23 20.66 15.71 19.14 15.71 17.26Z",stroke:"currentColor"}),_.createElement("path",{className:"success-icon",vectorEffect:"non-scaling-stroke",d:"M17.4805 17.49L18.5605 18.41L20.7205 16.33",stroke:"currentColor",strokeLinecap:"square",strokeLinejoin:"round"})),_.createElement("defs",null,_.createElement("clipPath",{id:"clip0_4797_15077"},_.createElement("rect",{width:22,height:18.65,fill:"white",transform:"translate(1 2.70001)"})))),_r=e=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},_.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),yr=({isLoading:e,customerName:n,orderNumber:a,orderStatus:i,onSignUpClick:o})=>e?r(vr,{}):d("div",{className:"order-confirmation-header order-confirmation__card",children:[r($,{source:pr,size:"64",className:"order-confirmation-header__icon"}),r("h1",{className:"order-confirmation-header__title",children:n?r(l,{id:"OrderConfirmation.Header.title",fields:{name:n}}):r(l,{id:"OrderConfirmation.Header.defaultTitle"})}),a&&d("p",{className:"order-confirmation-header__order",children:[r(l,{id:"OrderConfirmation.Header.order",fields:{order:a}}),i!==void 0&&i!==""&&d("span",{className:"order-confirmation-header__status",children:[" ","(",i,")"]})]}),o&&d("div",{className:"order-confirmation-create-account",children:[r("p",{className:"order-confirmation-create-account__message",children:r(l,{id:"OrderConfirmation.Header.CreateAccount.message"})}),r(B,{"data-testid":"create-account-button",className:"order-confirmation-create-account__button",size:"medium",variant:"secondary",type:"submit",onClick:o,children:r(l,{id:"OrderConfirmation.Header.CreateAccount.button"})})]})]}),vr=()=>d(w,{"data-testid":"order-confirmation-header-skeleton",className:"order-confirmation-header",children:[r(u,{variant:"empty",size:"xlarge",fullWidth:!0}),r(u,{variant:"empty",size:"medium"}),r(u,{variant:"empty",size:"medium"}),r(u,{variant:"empty",size:"medium"}),r(u,{variant:"empty",size:"medium"}),r(u,{variant:"empty",size:"medium"}),r(u,{size:"small",fullWidth:!0}),r(u,{variant:"heading",size:"xsmall",fullWidth:!0})]}),gr=({alert:e,onOrderSearch:n})=>{const a=P({email:"OrderConfirmation.OrderSearchForm.email",postcode:"OrderConfirmation.OrderSearchForm.postcode",number:"OrderConfirmation.OrderSearchForm.orderNumber"}),i=o=>{o.preventDefault();const t=rr(o.target);n==null||n(t)};return d(T,{variant:"secondary",className:"order-confirmation-order-search-form order-confirmation__card",children:[r("h2",{className:"order-confirmation-order-search-form__title",children:r(l,{id:"OrderConfirmation.OrderSearchForm.title"})}),r("p",{children:r(l,{id:"OrderConfirmation.OrderSearchForm.description"})}),e&&r(er,{className:"order-confirmation-order-search-form__alert","data-testid":"order-confirmation-alert",icon:r($,{source:_r}),...e}),d("form",{className:"order-confirmation-order-search-form__fields",onSubmit:i,children:[d("div",{className:"order-confirmation-order-search-form__fields-columns",children:[r(V,{children:r(W,{id:"order-email",name:"email",type:"email",autocomplete:"email",placeholder:a.email,floatingLabel:a.email,required:!0,"aria-label":a.email,"aria-required":!0})}),r(V,{children:r(W,{id:"postcode",name:"postcode",type:"text",autocomplete:"postal-code",placeholder:a.postcode,floatingLabel:a.postcode,required:!1,"aria-label":a.postcode,"aria-required":!0})})]}),r(V,{children:r(W,{id:"order-number",name:"number",type:"text",placeholder:a.number,floatingLabel:a.number,required:!0,"aria-label":a.number,"aria-required":!0})}),r(B,{className:"order-confirmation-order-search-form__button",size:"medium",variant:"primary",type:"submit",children:r(l,{id:"OrderConfirmation.OrderSearchForm.button"})},"logIn")]})]})},Or=({isLoading:e,orderDetails:n})=>{var I,z,H,j,D;if(e)return r(Cr,{});const a=n&&(n==null?void 0:n.number),i=(n==null?void 0:n.email)||"",o=n&&i!=="",t=n==null?void 0:n.shipping_address,m=n&&t!==null,c=n==null?void 0:n.billing_address,f=n&&c!==null,C=n==null?void 0:n.shipping_method,y=(z=(I=n==null?void 0:n.total)==null?void 0:I.total_shipping)==null?void 0:z.value,s=(j=(H=n==null?void 0:n.total)==null?void 0:H.total_shipping)==null?void 0:j.currency,h=n&&C&&s&&y!=null,p=n==null?void 0:n.payment_methods,g=p&&p.length>0,E=g?(D=p[0])==null?void 0:D.name:"",L=n&&g&&E!=="";return d(T,{"data-testid":"order-confirmation-details",variant:"secondary",className:"order-confirmation-details order-confirmation__card",children:[r("div",{className:"order-confirmation-details__header",children:r("h2",{className:"order-confirmation-details__title",children:r(l,{id:"OrderConfirmation.Details.title"})})}),d("div",{className:"order-confirmation-details__contact",children:[(!n||o)&&r("h3",{children:r(l,{id:"OrderConfirmation.Details.contact"})}),o&&r("p",{children:i}),!a&&r(N,{rows:1,"data-testid":"order-confirmation-details-contact-skeleton"})]}),d("div",{className:"order-confirmation-details__information",children:[d("div",{className:"order-confirmation-details__shipping_address",children:[(!a||m)&&r("h3",{children:r(l,{id:"OrderConfirmation.Details.shippingAddress"})}),m&&d(S,{children:[d("p",{children:[t==null?void 0:t.firstname," ",t==null?void 0:t.lastname]}),t==null?void 0:t.street.map((F,M)=>r("p",{children:F},M)),d("p",{children:[t==null?void 0:t.city," ",t==null?void 0:t.region," ",t==null?void 0:t.postcode,", ",t==null?void 0:t.country_code]})]}),!a&&r(N,{rows:3,"data-testid":"order-confirmation-shipping-address-skeleton"})]}),d("div",{className:"order-confirmation-details__billing_address",children:[(!a||f)&&r("h3",{children:r(l,{id:"OrderConfirmation.Details.billingAddress"})}),f&&d(S,{children:[d("p",{children:[c==null?void 0:c.firstname," ",c==null?void 0:c.lastname]}),c==null?void 0:c.street.map((F,M)=>r("p",{children:F},M)),d("p",{children:[c==null?void 0:c.city," ",c==null?void 0:c.region," ",c==null?void 0:c.postcode,", ",c==null?void 0:c.country_code]})]}),!a&&r(N,{rows:3,"data-testid":"order-confirmation-billing-address-skeleton"})]}),d("div",{className:"order-confirmation-details__shipping-method",children:[(!a||h)&&r("h3",{children:r(l,{id:"OrderConfirmation.Details.shippingMethod"})}),h&&r(S,{children:y===0?r("p",{className:"order-confirmation-order-summary__price",children:r(l,{id:"OrderConfirmation.Details.freeShipping"})}):d("p",{children:[r(O,{amount:y,currency:s})," ",C]})}),!a&&r(N,{rows:1,"data-testid":"order-confirmation-details-shipping-method-skeleton"})]}),d("div",{className:"order-confirmation-details__payment-method",children:[(!a||L)&&r("h3",{children:r(l,{id:"OrderConfirmation.Details.paymentMethod"})}),L&&r("p",{children:E}),!a&&r(N,{rows:1,"data-testid":"order-confirmation-details-payment-method-skeleton"})]})]})]})},Cr=()=>r(T,{variant:"secondary",className:"order-confirmation-details",children:d(w,{"data-testid":"order-confirmation-details-skeleton",children:[r(u,{variant:"heading",size:"medium",fullWidth:!0}),r(u,{size:"medium"}),r(u,{variant:"empty",size:"medium"}),r(u,{size:"xlarge"}),r(u,{size:"xlarge"}),r(u,{size:"xlarge"}),r(u,{size:"xlarge"})]})}),Nr=({isLoading:e,className:n,routeHome:a,routeSupport:i,...o})=>e?r(Sr,{}):d("div",{className:v(["order-confirmation-footer",n]),...o,children:[(a==null?void 0:a())&&r(B,{"data-testid":"order-confirmation-footer__continue-button",className:"order-confirmation-footer__continue-button",size:"medium",variant:"primary",type:"submit",href:a==null?void 0:a(),children:r(l,{id:"OrderConfirmation.Footer.continueShopping"})},"continueShopping"),d("p",{className:"order-confirmation-footer__contact-support",children:[r(l,{id:"OrderConfirmation.Footer.help"})," ",(i==null?void 0:i())&&r("a",{href:i==null?void 0:i(),rel:"noreferrer",className:"order-confirmation-footer__contact-support-link","data-testid":"order-confirmation-footer__contact-support-link",children:r(l,{id:"OrderConfirmation.Footer.contactSupport"})})]})]}),Sr=()=>d(w,{className:"order-confirmation-footer",children:[r(u,{size:"small",fullWidth:!0}),r(u,{variant:"heading",size:"xsmall",fullWidth:!0})]}),N=({rows:e,size:n="xsmall",...a})=>r(w,{className:"static-skeleton",...a,children:Array.from(Array(e).keys()).map(i=>r(u,{variant:"heading",size:n,fullWidth:!0},i))}),Er=({className:e,isLoading:n,summary:a,variant:i="secondary"})=>{if(n)return r(kr,{});const{total:o,subtotal:t,shipping:m,tax:c}=a??{};return d(T,{className:v(["order-confirmation-order-summary",e]),variant:i,children:[r("h2",{className:"order-confirmation-order-summary__title",children:r(l,{id:"OrderConfirmation.OrderSummary.title"})}),r(b,{variant:"primary"}),t!=null?d("div",{"data-testid":"order-summary-subtotal",className:"order-confirmation-order-summary__row",children:[r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.subtotal"})}),r(O,{amount:t==null?void 0:t.amount,currency:t==null?void 0:t.currency,className:v(["order-confirmation-order-summary__price",e])})]}):r(N,{rows:1,"data-testid":"order-confirmation-order-summary-subtotal-skeleton"}),(t==null?void 0:t.isTaxIncl)&&r("div",{"data-testid":"order-summary-subtotal-incl-tax",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--muted",children:r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.includingTaxes"})})}),m!=null?m.isVirtual?null:d("div",{"data-testid":"order-summary-shipping",className:"order-confirmation-order-summary__row",children:[r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.shipping"})}),m.amount===0?r("p",{className:"order-confirmation-order-summary__price",children:r(l,{id:"OrderConfirmation.OrderSummary.freeShipping"})}):r(O,{amount:m.amount,currency:m.currency,className:v(["order-confirmation-order-summary__price",e])})]}):r(N,{rows:1,"data-testid":"order-confirmation-order-summary-shipping-skeleton"}),c!=null&&!c.breakdown&&d("div",{"data-testid":"order-summary-tax",className:"order-confirmation-order-summary__row",children:[r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.tax"})}),r(O,{amount:c.amount,currency:c.currency,className:v(["order-confirmation-order-summary__price",e])})]}),c!=null&&c.breakdown&&d(S,{children:[r(b,{variant:"secondary"}),r("div",{className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--margin-bottom",children:r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.taxBreakdown"})})}),c.breakdown.map(f=>d("div",{"data-testid":"order-summary-tax-breakdown",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--muted",children:[r("p",{children:f.label}),r(O,{amount:f.amount.value,currency:f.amount.currency,className:v(["order-confirmation-order-summary__price",e])})]},f.label)),d("div",{"data-testid":"order-summary-tax-breakdown-total",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--strong order-confirmation-order-summary__row--margin-top",children:[r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.taxTotal"})}),r(O,{amount:c.amount,currency:c.currency,className:v(["order-confirmation-order-summary__price",e])})]}),r(b,{variant:"secondary"})]}),o!=null?d("div",{"data-testid":"order-summary-total-incl-tax",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--emphasized",children:[r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.total"})}),r(O,{amount:o==null?void 0:o.inclTax.amount,currency:o==null?void 0:o.inclTax.currency,className:v(["order-confirmation-order-summary__price",e])})]}):r(N,{rows:1,"data-testid":"order-confirmation-order-summary-total-skeleton"}),(o==null?void 0:o.exclTax)!=null&&d("div",{"data-testid":"order-summary-total-excl-tax",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--muted",children:[r("p",{children:r(l,{id:"OrderConfirmation.OrderSummary.totalExclTax"})}),r(O,{amount:o.exclTax.amount,currency:o.exclTax.currency,className:v(["order-confirmation-order-summary__price",e])})]})]})},kr=()=>d(w,{"data-testid":"order-confirmation-order-summary-skeleton",className:"order-confirmation-order-summary",children:[r(u,{variant:"heading",size:"small"}),r(u,{variant:"empty",size:"small"}),r(u,{variant:"empty",size:"small"}),r(u,{variant:"empty",size:"small"}),r(u,{variant:"heading",size:"small",fullWidth:!0,lines:3})]}),wr=({className:e,item:n,taxIncluded:a=!1})=>{const i=P({Sender:"OrderConfirmation.CartSummary.GiftCard.sender",Recipient:"OrderConfirmation.CartSummary.GiftCard.recipient"});let o=n.regularPrice,t=n.total;a&&(o=n.priceInclTax,t=n.totalInclTax);const m={..."configurableOptions"in n?n.configurableOptions:{},..."senderName"in n&&n.senderName?{[i.Sender]:n.senderName}:{},..."senderEmail"in n&&n.senderEmail?{[i.Sender]:n.senderEmail}:{},..."recipientName"in n&&n.recipientName?{[i.Recipient]:n.recipientName}:{},..."recipientEmail"in n&&n.recipientEmail?{[i.Recipient]:n.recipientEmail}:{}};return r("div",{className:v(["order-confirmation-cart-summary-item",e]),children:r(nr,{"data-testid":"cart-summary-item",taxIncluded:a,title:r("div",{"data-testid":"product-name",children:n.name}),sku:r("div",{children:n.sku}),quantity:n.quantity,image:r(tr,{src:n.image.src,alt:n.image.alt,loading:"lazy",width:"80",height:"80",params:{width:80}}),configurations:m,price:r(O,{amount:n.regularPrice.value,currency:o.currency,weight:"normal"}),total:d(S,{children:[r(O,{amount:n.regularPrice.value*n.quantity,currency:o.currency,variant:n.discounted?"strikethrough":"default"}),n.discounted&&r(O,{amount:t.value,currency:t.currency,sale:!0})]})},n.uid)})};function Lr(e){return{uid:e.id,quantity:e.quantity_ordered,sku:e.product.sku,name:e.product.name,image:{src:e.product.thumbnail.url,alt:e.product.thumbnail.label},price:{value:e.product_sale_price.value,currency:e.product_sale_price.currency},priceInclTax:{value:e.product_sale_price.value,currency:e.product_sale_price.currency},total:{value:e.product_sale_price.value*e.quantity_ordered,currency:e.product_sale_price.currency},totalInclTax:{value:e.product_sale_price.value*e.quantity_ordered,currency:e.product_sale_price.currency},discount:{value:0,currency:e.product_sale_price.currency},regularPrice:{value:e.product.price_range.maximum_price.regular_price.value,currency:e.product.price_range.maximum_price.regular_price.currency},discounted:e.product.price_range.maximum_price.regular_price.value*e.quantity_ordered!==e.product_sale_price.value*e.quantity_ordered,configurableOptions:Ir(e),senderName:e.__typename==="GiftCardOrderItem"?e.gift_card.sender_name:void 0,senderEmail:e.__typename==="GiftCardOrderItem"?e.gift_card.sender_email:void 0,recipientEmail:e.__typename==="GiftCardOrderItem"?e.gift_card.recipient_email:void 0,recipientName:e.__typename==="GiftCardOrderItem"?e.gift_card.recipient_name:void 0}}function Ir(e){if(!("selected_options"in e))return;const n={};for(const a of e.selected_options)n[a.label]=a.value;return n}const xr=({isLoading:e,details:n})=>{if(e)return r(Rr,{});const a=!1,i=n.items,o=i.length;return r("div",{className:"order-confirmation-cart-summary",children:d(T,{variant:"secondary",children:[r("div",{className:"order-confirmation-cart-summary__heading",children:d("h2",{className:"order-confirmation-cart-summary__title",children:[r(l,{id:"OrderConfirmation.CartSummary.title"})," (",o,")"]})}),r(b,{className:"order-confirmation-cart-summary__divider-top",variant:"primary"}),r("div",{className:"order-confirmation-cart-summary__items",children:i==null?void 0:i.map(t=>{const m=Lr(t);return r(wr,{item:m,taxIncluded:a},m==null?void 0:m.uid)})})]})})},Rr=()=>d(w,{"data-testid":"cart-summary-skeleton",className:"order-confirmation-cart-summary",style:{gridTemplateColumns:"1fr"},children:[r(u,{variant:"heading",fullWidth:!0,size:"medium"}),r(x,{}),r(x,{}),r(x,{}),r(x,{}),r(x,{})]});function q(e){return{region:{region_id:e!=null&&e.region_id?Number(e==null?void 0:e.region_id):null,region:e==null?void 0:e.region},city:e==null?void 0:e.city,company:e==null?void 0:e.company,country_code:e==null?void 0:e.country_code,firstname:e==null?void 0:e.firstname,lastname:e==null?void 0:e.lastname,middlename:e==null?void 0:e.middlename,postcode:e==null?void 0:e.postcode,street:e==null?void 0:e.street,telephone:e==null?void 0:e.telephone}}function Tr(e){const[n,a]=ar(dr,{isLoading:!1,orderRef:e,details:null,isOrderFromSearchForm:!1}),[i,o]=or(),t=P({invalidOrder:"OrderConfirmation.Errors.invalidOrder",invalidSearch:"OrderConfirmation.Errors.invalidSearch",pageNotFound:"OrderConfirmation.Errors.pageNotFound",unknown:"OrderConfirmation.Errors.unknown"}),m=A(s=>{switch(s){case"Invalid order":case"Order not found":case"We couldn't locate an order with the information provided.":return{type:G.WARNING,code:R.INVALID_ORDER,message:t.invalidOrder};case"Invalid search":return{type:G.WARNING,code:R.INVALID_SEARCH,message:t.invalidSearch}}},[t.invalidOrder,t.invalidSearch]),c=()=>{a({type:k.DISMISS_ALERT})},f=function(s){C(s)};Z(()=>{const s=ir.on("authenticated",h=>{o(h)},{eager:!0});return()=>{s==null||s.off()}},[]);const C=A(s=>{K(s).then(h=>{const g=!!(h!=null&&h.number)?void 0:m("Invalid search");a({type:k.SET_DETAILS,fromSearchForm:!0,alert:g,details:h})}).catch(()=>{const h=m("Invalid search");a({type:k.SET_DETAILS,details:null,alert:h})})},[m]),y=A(s=>{(i?Q:J)(s).then(p=>{const E=!!(p!=null&&p.number)?void 0:m("Invalid order");a({type:k.SET_DETAILS,details:p,alert:E})}).catch(p=>{const g=m(p.message);if(!g){console.error(p);return}a({type:k.ALERT,alert:g})})},[i,m]);return Z(()=>{!n.orderRef||i===void 0||(a({type:k.LOADING}),y(n.orderRef))},[i,y,n.orderRef]),{state:n,authenticated:i,handleOrderSearch:f,dismissAlert:c}}const Br=({orderRef:e,routeHome:n,routeSupport:a,onSignUpClick:i})=>{const{state:o,authenticated:t,handleOrderSearch:m,dismissAlert:c}=Tr(e);if(t===void 0)return null;const C=i&&!t&&!o.isOrderFromSearchForm?()=>{var g,E,L;const y=(g=o.details)==null?void 0:g.shipping_address,s=(E=o.details)==null?void 0:E.billing_address,h=[{code:"firstname",defaultValue:(s==null?void 0:s.firstname)||""},{code:"lastname",defaultValue:(s==null?void 0:s.lastname)||""},{code:"email",defaultValue:((L=o.details)==null?void 0:L.email)||""}];let p;if(y){const I={...q(y),default_shipping:!0};p=[{...q(s),default_billing:!0},I]}else p=[{...q(s),default_billing:!0,default_shipping:!0}];i({inputsDefaultValueSet:h,addressesData:p})}:void 0;return r(hr,{state:o,dismissAlert:c,onOrderSearch:m,routeHome:n,routeSupport:a,onSignUpClick:C})};export{Br as OrderConfirmation,Br as default};
//# sourceMappingURL=OrderConfirmation.js.map
=======
import{jsx as e,jsxs as l,Fragment as L}from"@dropins/tools/preact-jsx-runtime.js";import{a as Y,f as I,d as rr,h as nr,e as er}from"../chunks/customerOrder.js";import{events as $}from"@dropins/tools/event-bus.js";import{useState as ar,useEffect as ir}from"@dropins/tools/preact-hooks.js";import{classes as E,getFormValues as tr}from"@dropins/tools/lib.js";import{Icon as J,Button as B,Skeleton as T,SkeletonRow as f,Card as F,InLineAlert as or,Field as M,Input as D,Price as S,Divider as V,CartItem as cr,Image as lr,CartItemSkeleton as R}from"@dropins/tools/components.js";import*as O from"@dropins/tools/preact-compat.js";import{useReducer as sr,useState as U,useCallback as q,useEffect as x}from"@dropins/tools/preact-compat.js";import{Text as m,useText as P}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const ur=`
  query isEmailAvailable($email: String!) {
    isEmailAvailable(email: $email) {
      is_email_available
    }
  }
`,mr=n=>{if(!(!n||n.length===0))throw Error(n.map(r=>r.message).join(" "))},dr=n=>{throw n instanceof DOMException&&n.name==="AbortError"||$.emit("error",{source:"checkout",type:"network",error:n}),n},fr=async n=>{var t;if(!n)throw new Y;const{data:r,errors:i}=await I(ur,{method:"GET",cache:"no-cache",variables:{email:n}}).catch(dr);return i&&mr(i),!!((t=r.isEmailAvailable)!=null&&t.is_email_available)},hr=()=>{const n=()=>window.innerWidth>=1920?"xxlarge":window.innerWidth>=1366?"xlarge":window.innerWidth>=1024?"large":window.innerWidth>=768?"medium":"small",[r,i]=ar(n());return ir(()=>{let t;const o=()=>{t&&clearTimeout(t),t=setTimeout(()=>i(n()),50)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),t&&clearTimeout(t)}},[]),r};var C=(n=>(n.ADD_ORDER_REFERENCE="ADD_ORDER_REFERENCE",n.LOADING="LOADING",n.SET_DETAILS="SET_DETAILS",n.ALERT="ALERT",n.DISMISS_ALERT="DISMISS_ALERT",n.DATA_FETCHED="DATA_FETCHED",n.UNKNOWN_ERROR="UNKNOWN_ERROR",n))(C||{}),H=(n=>(n.ERROR="error",n.WARNING="warning",n.SUCCESS="success",n))(H||{}),A=(n=>(n.INVALID_ORDER="invalid_order",n.INVALID_SEARCH="invalid_search",n.UNKNOWN="unknown_error",n))(A||{});function pr(n,r){switch(r.type){case"LOADING":return{...n,isLoading:!0};case"SET_DETAILS":return{...n,details:r.details,alert:r.alert,isOrderFromSearchForm:r.fromSearchForm||!1};case"ALERT":return{...n,isLoading:!1,alert:r.alert};case"DISMISS_ALERT":return{...n,alert:void 0};case"DATA_FETCHED":return{...n,isLoading:!1};case"UNKNOWN_ERROR":return{...n,isLoading:!1};default:return n}}const X=({children:n,className:r})=>hr()!=="small"?e("div",{className:r,children:n}):e(L,{children:n});function _r(n){if(!n)return;const r=n.grandTotal,i=n.isVirtual,t=n.subtotal,o=n.shipping,a=n.totalTax;return{total:{inclTax:{amount:r.value,currency:r.currency}},subtotal:{amount:(t==null?void 0:t.value)||0,currency:(t==null?void 0:t.currency)||"",isTaxIncl:!1},shipping:{amount:(o==null?void 0:o.amount)||0,currency:(o==null?void 0:o.currency)||"",isVirtual:i},tax:{amount:(a==null?void 0:a.value)||0,currency:(a==null?void 0:a.currency)||""}}}const yr=({state:n})=>{const{isLoading:r,details:i}=n,t=_r(i);return l(L,{children:[e(xr,{isLoading:r,summary:t}),e(zr,{isLoading:r,details:i})]})},vr=({state:n})=>e(X,{className:"order-confirmation__aside",children:e(yr,{state:n})}),gr=({state:n,routeHome:r,routeSupport:i,onSignUpClick:t})=>{const{details:o,isLoading:a}=n,u=o==null?void 0:o.billingAddress,c=(u==null?void 0:u.firstName)||"",s=(o==null?void 0:o.number)||"",h=(o==null?void 0:o.status)||"";return l(L,{children:[(a||!a&&(!!c&&!!s))&&e(Sr,{isLoading:a,customerName:c,orderNumber:s,orderStatus:h,onSignUpClick:t}),e(br,{isLoading:a,orderDetails:o}),e(Tr,{isLoading:a,routeHome:r,routeSupport:i})]})},Nr=({state:n,routeHome:r,routeSupport:i,dismissAlert:t,onOrderSearch:o,onSignUpClick:a})=>e(X,{className:"order-confirmation__main",children:e(gr,{state:n,routeHome:r,routeSupport:i,dismissAlert:t,onOrderSearch:o,onSignUpClick:a})}),Or=({className:n,state:r,dismissAlert:i,routeHome:t,routeSupport:o,onOrderSearch:a,onSignUpClick:u})=>{const{details:c,alert:s,isLoading:h}=r,v=!!(c!=null&&c.number),N=s&&s.code===A.INVALID_ORDER,g=s&&s.code===A.INVALID_SEARCH;return!h&&!v?e("div",{className:E(["order-confirmation",n]),children:e(kr,{alert:N||g?{heading:s.message,description:"",type:s.type,onDismiss:i}:void 0,onOrderSearch:a})}):l("div",{className:E(["order-confirmation",n]),children:[e(Nr,{state:r,dismissAlert:i,routeHome:t,routeSupport:o,onOrderSearch:a,onSignUpClick:u}),e(vr,{state:r})]})},Er=n=>O.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},O.createElement("g",{clipPath:"url(#clip0_4797_15077)"},O.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.15 20.85L1.5 17.53V6.63L10.15 10V20.85Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),O.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.63001L10.15 3.20001L18.8 6.63001L10.15 10L1.5 6.63001Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),O.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.17969 4.77002L14.8297 8.15002V11.47",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),O.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.7896 12.64V6.63L10.1396 10V20.85L14.8296 19.05",stroke:"currentColor",strokeLinejoin:"round"}),O.createElement("path",{className:"success-icon",vectorEffect:"non-scaling-stroke",d:"M15.71 17.26C15.71 15.38 17.23 13.86 19.11 13.86C20.99 13.86 22.51 15.38 22.51 17.26C22.51 19.14 20.99 20.66 19.11 20.66C17.23 20.66 15.71 19.14 15.71 17.26Z",stroke:"currentColor"}),O.createElement("path",{className:"success-icon",vectorEffect:"non-scaling-stroke",d:"M17.4805 17.49L18.5605 18.41L20.7205 16.33",stroke:"currentColor",strokeLinecap:"square",strokeLinejoin:"round"})),O.createElement("defs",null,O.createElement("clipPath",{id:"clip0_4797_15077"},O.createElement("rect",{width:22,height:18.65,fill:"white",transform:"translate(1 2.70001)"})))),Cr=n=>O.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},O.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),Sr=({isLoading:n,customerName:r,orderNumber:i,orderStatus:t,onSignUpClick:o})=>n?e(wr,{}):l("div",{className:"order-confirmation-header order-confirmation__card",children:[e(J,{source:Er,size:"64",className:"order-confirmation-header__icon"}),e("h1",{className:"order-confirmation-header__title",children:r?e(m,{id:"OrderConfirmation.Header.title",fields:{name:r}}):e(m,{id:"OrderConfirmation.Header.defaultTitle"})}),i&&l("p",{className:"order-confirmation-header__order",children:[e(m,{id:"OrderConfirmation.Header.order",fields:{order:i}}),t!==void 0&&t!==""&&l("span",{className:"order-confirmation-header__status",children:[" ","(",t,")"]})]}),o&&l("div",{className:"order-confirmation-create-account",children:[e("p",{className:"order-confirmation-create-account__message",children:e(m,{id:"OrderConfirmation.Header.CreateAccount.message"})}),e(B,{"data-testid":"create-account-button",className:"order-confirmation-create-account__button",size:"medium",variant:"secondary",type:"submit",onClick:o,children:e(m,{id:"OrderConfirmation.Header.CreateAccount.button"})})]})]}),wr=()=>l(T,{"data-testid":"order-confirmation-header-skeleton",className:"order-confirmation-header",children:[e(f,{variant:"empty",size:"xlarge",fullWidth:!0}),e(f,{variant:"empty",size:"medium"}),e(f,{variant:"empty",size:"medium"}),e(f,{variant:"empty",size:"medium"}),e(f,{variant:"empty",size:"medium"}),e(f,{variant:"empty",size:"medium"}),e(f,{size:"small",fullWidth:!0}),e(f,{variant:"heading",size:"xsmall",fullWidth:!0})]}),kr=({alert:n,onOrderSearch:r})=>{const i=P({email:"OrderConfirmation.OrderSearchForm.email",postcode:"OrderConfirmation.OrderSearchForm.postcode",number:"OrderConfirmation.OrderSearchForm.orderNumber"}),t=o=>{o.preventDefault();const a=tr(o.target);r==null||r(a)};return l(F,{variant:"secondary",className:"order-confirmation-order-search-form order-confirmation__card",children:[e("h2",{className:"order-confirmation-order-search-form__title",children:e(m,{id:"OrderConfirmation.OrderSearchForm.title"})}),e("p",{children:e(m,{id:"OrderConfirmation.OrderSearchForm.description"})}),n&&e(or,{className:"order-confirmation-order-search-form__alert","data-testid":"order-confirmation-alert",icon:e(J,{source:Cr}),...n}),l("form",{className:"order-confirmation-order-search-form__fields",onSubmit:t,children:[l("div",{className:"order-confirmation-order-search-form__fields-columns",children:[e(M,{children:e(D,{id:"order-email",name:"email",type:"email",autocomplete:"email",placeholder:i.email,floatingLabel:i.email,required:!0,"aria-label":i.email,"aria-required":!0})}),e(M,{children:e(D,{id:"postcode",name:"postcode",type:"text",autocomplete:"postal-code",placeholder:i.postcode,floatingLabel:i.postcode,required:!1,"aria-label":i.postcode,"aria-required":!0})})]}),e(M,{children:e(D,{id:"order-number",name:"number",type:"text",placeholder:i.number,floatingLabel:i.number,required:!0,"aria-label":i.number,"aria-required":!0})}),e(B,{className:"order-confirmation-order-search-form__button",size:"medium",variant:"primary",type:"submit",children:e(m,{id:"OrderConfirmation.OrderSearchForm.button"})},"logIn")]})]})},br=({isLoading:n,orderDetails:r})=>{var w,z,j,Q;if(n)return e(Lr,{});const i=r&&(r==null?void 0:r.number),t=(r==null?void 0:r.email)||"",o=r&&t!=="",a=r==null?void 0:r.shippingAddress,u=r&&a,c=r==null?void 0:r.billingAddress,s=r&&c,h=(w=r==null?void 0:r.shipping)==null?void 0:w.code,v=(z=r==null?void 0:r.shipping)==null?void 0:z.amount,N=(j=r==null?void 0:r.shipping)==null?void 0:j.currency,g=r&&h&&N&&v!==void 0,p=r==null?void 0:r.payments,d=p&&p.length>0,_=d?(Q=p[0])==null?void 0:Q.name:"",y=r&&d&&_!=="";return l(F,{"data-testid":"order-confirmation-details",variant:"secondary",className:"order-confirmation-details order-confirmation__card",children:[e("div",{className:"order-confirmation-details__header",children:e("h2",{className:"order-confirmation-details__title",children:e(m,{id:"OrderConfirmation.Details.title"})})}),l("div",{className:"order-confirmation-details__contact",children:[!r||o?e("h3",{children:e(m,{id:"OrderConfirmation.Details.contact"})}):null,o?e("p",{children:t}):null,i?null:e(b,{rows:1,"data-testid":"order-confirmation-details-contact-skeleton"})]}),l("div",{className:"order-confirmation-details__information",children:[l("div",{className:"order-confirmation-details__shipping_address",children:[!i||u?e("h3",{children:e(m,{id:"OrderConfirmation.Details.shippingAddress"})}):null,u?l(L,{children:[l("p",{children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]}),a==null?void 0:a.street.map((k,W)=>e("p",{children:k},W)),l("p",{children:[a==null?void 0:a.city," ",a==null?void 0:a.region," ",a==null?void 0:a.postCode,", ",a==null?void 0:a.country]}),a==null?void 0:a.customAttributes.map(k=>e("p",{children:k.value},k.code))]}):null,i?null:e(b,{rows:3,"data-testid":"order-confirmation-shipping-address-skeleton"})]}),l("div",{className:"order-confirmation-details__billing_address",children:[!i||s?e("h3",{children:e(m,{id:"OrderConfirmation.Details.billingAddress"})}):null,s?l(L,{children:[l("p",{children:[c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]}),c==null?void 0:c.street.map((k,W)=>e("p",{children:k},W)),l("p",{children:[c==null?void 0:c.city," ",c==null?void 0:c.region," ",c==null?void 0:c.postCode,", ",c==null?void 0:c.country]}),c==null?void 0:c.customAttributes.map(k=>e("p",{children:k.value},k.code))]}):null,i?null:e(b,{rows:3,"data-testid":"order-confirmation-billing-address-skeleton"})]}),l("div",{className:"order-confirmation-details__shipping-method",children:[!i||g?e("h3",{children:e(m,{id:"OrderConfirmation.Details.shippingMethod"})}):null,g?e(L,{children:v===0?e("p",{className:"order-confirmation-order-summary__price",children:e(m,{id:"OrderConfirmation.Details.freeShipping"})}):l("p",{children:[e(S,{amount:v,currency:N})," ",h]})}):null,i?null:e(b,{rows:1,"data-testid":"order-confirmation-details-shipping-method-skeleton"})]}),l("div",{className:"order-confirmation-details__payment-method",children:[!i||y?e("h3",{children:e(m,{id:"OrderConfirmation.Details.paymentMethod"})}):null,y&&e("p",{children:_}),i?null:e(b,{rows:1,"data-testid":"order-confirmation-details-payment-method-skeleton"})]})]})]})},Lr=()=>e(F,{variant:"secondary",className:"order-confirmation-details",children:l(T,{"data-testid":"order-confirmation-details-skeleton",children:[e(f,{variant:"heading",size:"medium",fullWidth:!0}),e(f,{size:"medium"}),e(f,{variant:"empty",size:"medium"}),e(f,{size:"xlarge"}),e(f,{size:"xlarge"}),e(f,{size:"xlarge"}),e(f,{size:"xlarge"})]})}),Tr=({isLoading:n,className:r,routeHome:i,routeSupport:t,...o})=>n?e(Rr,{}):l("div",{className:E(["order-confirmation-footer",r]),...o,children:[(i==null?void 0:i())&&e(B,{"data-testid":"order-confirmation-footer__continue-button",className:"order-confirmation-footer__continue-button",size:"medium",variant:"primary",type:"submit",href:i==null?void 0:i(),children:e(m,{id:"OrderConfirmation.Footer.continueShopping"})},"continueShopping"),l("p",{className:"order-confirmation-footer__contact-support",children:[e(m,{id:"OrderConfirmation.Footer.help"})," ",(t==null?void 0:t())&&e("a",{href:t==null?void 0:t(),rel:"noreferrer",className:"order-confirmation-footer__contact-support-link","data-testid":"order-confirmation-footer__contact-support-link",children:e(m,{id:"OrderConfirmation.Footer.contactSupport"})})]})]}),Rr=()=>l(T,{className:"order-confirmation-footer",children:[e(f,{size:"small",fullWidth:!0}),e(f,{variant:"heading",size:"xsmall",fullWidth:!0})]}),b=({rows:n,size:r="xsmall",...i})=>e(T,{className:"static-skeleton",...i,children:Array.from(Array(n).keys()).map(t=>e(f,{variant:"heading",size:r,fullWidth:!0},t))}),xr=({className:n,isLoading:r,summary:i,variant:t="secondary"})=>{if(r)return e(Ar,{});const{total:o,subtotal:a,shipping:u,tax:c}=i??{};return l(F,{className:E(["order-confirmation-order-summary",n]),variant:t,children:[e("h2",{className:"order-confirmation-order-summary__title",children:e(m,{id:"OrderConfirmation.OrderSummary.title"})}),e(V,{variant:"primary"}),a!=null?l("div",{"data-testid":"order-summary-subtotal",className:"order-confirmation-order-summary__row",children:[e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.subtotal"})}),e(S,{amount:a==null?void 0:a.amount,currency:a==null?void 0:a.currency,className:E(["order-confirmation-order-summary__price",n])})]}):e(b,{rows:1,"data-testid":"order-confirmation-order-summary-subtotal-skeleton"}),(a==null?void 0:a.isTaxIncl)&&e("div",{"data-testid":"order-summary-subtotal-incl-tax",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--muted",children:e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.includingTaxes"})})}),u!=null?u.isVirtual?null:l("div",{"data-testid":"order-summary-shipping",className:"order-confirmation-order-summary__row",children:[e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.shipping"})}),u.amount===0?e("p",{className:"order-confirmation-order-summary__price",children:e(m,{id:"OrderConfirmation.OrderSummary.freeShipping"})}):e(S,{amount:u.amount,currency:u.currency,className:E(["order-confirmation-order-summary__price",n])})]}):e(b,{rows:1,"data-testid":"order-confirmation-order-summary-shipping-skeleton"}),c!=null&&!c.breakdown&&l("div",{"data-testid":"order-summary-tax",className:"order-confirmation-order-summary__row",children:[e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.tax"})}),e(S,{amount:c.amount,currency:c.currency,className:E(["order-confirmation-order-summary__price",n])})]}),c!=null&&c.breakdown&&l(L,{children:[e(V,{variant:"secondary"}),e("div",{className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--margin-bottom",children:e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.taxBreakdown"})})}),c.breakdown.map(s=>l("div",{"data-testid":"order-summary-tax-breakdown",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--muted",children:[e("p",{children:s.label}),e(S,{amount:s.amount.value,currency:s.amount.currency,className:E(["order-confirmation-order-summary__price",n])})]},s.label)),l("div",{"data-testid":"order-summary-tax-breakdown-total",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--strong order-confirmation-order-summary__row--margin-top",children:[e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.taxTotal"})}),e(S,{amount:c.amount,currency:c.currency,className:E(["order-confirmation-order-summary__price",n])})]}),e(V,{variant:"secondary"})]}),o!=null?l("div",{"data-testid":"order-summary-total-incl-tax",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--emphasized",children:[e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.total"})}),e(S,{amount:o==null?void 0:o.inclTax.amount,currency:o==null?void 0:o.inclTax.currency,className:E(["order-confirmation-order-summary__price",n])})]}):e(b,{rows:1,"data-testid":"order-confirmation-order-summary-total-skeleton"}),(o==null?void 0:o.exclTax)!=null&&l("div",{"data-testid":"order-summary-total-excl-tax",className:"order-confirmation-order-summary__row order-confirmation-order-summary__row--muted",children:[e("p",{children:e(m,{id:"OrderConfirmation.OrderSummary.totalExclTax"})}),e(S,{amount:o.exclTax.amount,currency:o.exclTax.currency,className:E(["order-confirmation-order-summary__price",n])})]})]})},Ar=()=>l(T,{"data-testid":"order-confirmation-order-summary-skeleton",className:"order-confirmation-order-summary",children:[e(f,{variant:"heading",size:"small"}),e(f,{variant:"empty",size:"small"}),e(f,{variant:"empty",size:"small"}),e(f,{variant:"empty",size:"small"}),e(f,{variant:"heading",size:"small",fullWidth:!0,lines:3})]}),Fr=({className:n,item:r,taxIncluded:i=!1})=>{const t=P({Sender:"OrderConfirmation.CartSummary.GiftCard.sender",Recipient:"OrderConfirmation.CartSummary.GiftCard.recipient"});let o=r.regularPrice,a=r.total;i&&(o=r.priceInclTax,a=r.totalInclTax);const u={..."configurableOptions"in r?r.configurableOptions:{},..."senderName"in r&&r.senderName?{[t.Sender]:r.senderName}:{},..."senderEmail"in r&&r.senderEmail?{[t.Sender]:r.senderEmail}:{},..."recipientName"in r&&r.recipientName?{[t.Recipient]:r.recipientName}:{},..."recipientEmail"in r&&r.recipientEmail?{[t.Recipient]:r.recipientEmail}:{}};return e("div",{className:E(["order-confirmation-cart-summary-item",n]),children:e(cr,{"data-testid":"cart-summary-item",taxIncluded:i,title:e("div",{"data-testid":"product-name",children:r.product.name}),sku:e("div",{children:r.product.sku}),quantity:r.totalQuantity,image:e(lr,{src:r.thumbnail.url,alt:r.thumbnail.label,loading:"lazy",width:"80",height:"80",params:{width:80}}),configurations:u,price:e(S,{amount:r.regularPrice.value,currency:o.currency,weight:"normal"}),total:l(L,{children:[e(S,{amount:r.regularPrice.value*r.totalQuantity,currency:o.currency,variant:r.discounted?"strikethrough":"default"}),r.discounted&&e(S,{amount:a.value,currency:a.currency,sale:!0})]})},r.id)})},zr=({isLoading:n,details:r})=>{if(n)return e(Vr,{});const i=!1,t=r.items,o=t.length;return e("div",{className:"order-confirmation-cart-summary",children:l(F,{variant:"secondary",children:[e("div",{className:"order-confirmation-cart-summary__heading",children:l("h2",{className:"order-confirmation-cart-summary__title",children:[e(m,{id:"OrderConfirmation.CartSummary.title"})," (",o,")"]})}),e(V,{className:"order-confirmation-cart-summary__divider-top",variant:"primary"}),e("div",{className:"order-confirmation-cart-summary__items",children:t==null?void 0:t.map(a=>e(Fr,{item:a,taxIncluded:i},a.id))})]})})},Vr=()=>l(T,{"data-testid":"cart-summary-skeleton",className:"order-confirmation-cart-summary",style:{gridTemplateColumns:"1fr"},children:[e(f,{variant:"heading",fullWidth:!0,size:"medium"}),e(R,{}),e(R,{}),e(R,{}),e(R,{}),e(R,{})]});function G(n){return{region:{region_id:n!=null&&n.regionId?Number(n==null?void 0:n.regionId):null,region:n==null?void 0:n.region},city:n==null?void 0:n.city,company:n==null?void 0:n.company,country_code:n==null?void 0:n.country,firstname:n==null?void 0:n.firstName,lastname:n==null?void 0:n.lastName,middlename:n==null?void 0:n.middleName,postcode:n==null?void 0:n.postCode,street:n==null?void 0:n.street,telephone:n==null?void 0:n.telephone,custom_attributesV2:n==null?void 0:n.customAttributes.map(r=>({attribute_code:r.code,value:r.value}))}}const Wr=n=>n||0,Mr=n=>({name:(n==null?void 0:n.name)||"",sku:(n==null?void 0:n.sku)||"",productType:(n==null?void 0:n.__typename)||""});function Dr(n){if(!n||!("selected_options"in n))return;const r={};for(const i of n.selected_options)r[i.label]=i.value;return r}const qr=n=>n?n.map(r=>{var i,t,o,a,u,c,s,h,v,N,g,p,d,_;return{type:r==null?void 0:r.__typename,id:r==null?void 0:r.id,discounted:(r==null?void 0:r.product.price_range.maximum_price.regular_price.value)*(r==null?void 0:r.quantity_ordered)!==(r==null?void 0:r.product_sale_price.value)*(r==null?void 0:r.quantity_ordered),total:{value:(r==null?void 0:r.product_sale_price.value)*(r==null?void 0:r.quantity_ordered),currency:r==null?void 0:r.product_sale_price.currency},totalInclTax:{value:(r==null?void 0:r.product_sale_price.value)*(r==null?void 0:r.quantity_ordered),currency:r==null?void 0:r.product_sale_price.currency},price:{value:r==null?void 0:r.product_sale_price.value,currency:r==null?void 0:r.product_sale_price.currency},priceInclTax:{value:r==null?void 0:r.product_sale_price.value,currency:r==null?void 0:r.product_sale_price.currency},totalQuantity:Wr(r==null?void 0:r.quantity_ordered),regularPrice:{value:(o=(t=(i=r==null?void 0:r.product)==null?void 0:i.price_range)==null?void 0:t.maximum_price)==null?void 0:o.regular_price.value,currency:(c=(u=(a=r==null?void 0:r.product)==null?void 0:a.price_range)==null?void 0:u.maximum_price)==null?void 0:c.regular_price.currency},product:Mr(r==null?void 0:r.product),thumbnail:{label:((h=(s=r==null?void 0:r.product)==null?void 0:s.thumbnail)==null?void 0:h.label)||"",url:((N=(v=r==null?void 0:r.product)==null?void 0:v.thumbnail)==null?void 0:N.url)||""},giftCard:(r==null?void 0:r.__typename)==="GiftCardOrderItem"?{senderName:((g=r.gift_card)==null?void 0:g.sender_name)||"",senderEmail:((p=r.gift_card)==null?void 0:p.sender_email)||"",recipientEmail:((d=r.gift_card)==null?void 0:d.recipient_email)||"",recipientName:((_=r.gift_card)==null?void 0:_.recipient_name)||""}:void 0,configurableOptions:Dr(r)}}):[];function Gr(n){return n!==null&&n.value!==void 0}const Z=n=>n?{city:n.city,company:n.company||"",country:n.country_code||"",firstName:n.firstname,middleName:n.middlename||"",lastName:n.lastname,postCode:n.postcode||"",regionId:n.region_id||"",region:n.region||"",street:n.street.filter(r=>r!==null),telephone:n.telephone||"",customAttributes:n.custom_attributesV2.filter(Gr).map(r=>({code:r.code,value:r.value}))}:null,K=n=>{var u,c,s,h,v,N,g,p,d;const r=(u=n.payment_methods)==null?void 0:u[0],i=(r==null?void 0:r.type)??"",t=(r==null?void 0:r.name)??"",o=qr(n.items),a=o.reduce((_,y)=>_+y.totalQuantity,0);return{status:n.status,isVirtual:n.is_virtual,email:n.email??"",items:o,number:n.number,grandTotal:{value:((c=n.total)==null?void 0:c.grand_total.value)??0,currency:((s=n.total)==null?void 0:s.grand_total.currency)||""},totalQuantity:a,totalTax:{value:((h=n.total)==null?void 0:h.total_tax.value)??0,currency:((v=n.total)==null?void 0:v.total_tax.currency)||""},subtotal:{value:((N=n.total)==null?void 0:N.subtotal.value)??0,currency:((g=n.total)==null?void 0:g.subtotal.currency)||""},shipping:{amount:((p=n.total)==null?void 0:p.total_shipping.value)??0,currency:((d=n.total)==null?void 0:d.total_shipping.currency)||"",code:n.shipping_method??""},payments:[{code:i,name:t}],shippingAddress:Z(n.shipping_address),billingAddress:Z(n.billing_address)}};function Hr({orderRef:n,orderData:r}){const[i,t]=sr(pr,{isLoading:!1,orderData:r,orderRef:n,details:null,isOrderFromSearchForm:!1}),[o,a]=U(),[u,c]=U(),s=P({invalidOrder:"OrderConfirmation.Errors.invalidOrder",invalidSearch:"OrderConfirmation.Errors.invalidSearch",pageNotFound:"OrderConfirmation.Errors.pageNotFound",unknown:"OrderConfirmation.Errors.unknown"}),h=q(d=>{switch(d){case"Invalid order":case"Order not found":case"We couldn't locate an order with the information provided.":return{type:H.WARNING,code:A.INVALID_ORDER,message:s.invalidOrder};case"Invalid search":return{type:H.WARNING,code:A.INVALID_SEARCH,message:s.invalidSearch}}},[s.invalidOrder,s.invalidSearch]),v=()=>{t({type:C.DISMISS_ALERT})},N=function(d){g(d)};x(()=>{const d=$.on("authenticated",_=>{a(_)},{eager:!0});return()=>{d==null||d.off()}},[]);const g=q(d=>{rr(d).then(_=>{const w=!!(_!=null&&_.number)?void 0:h("Invalid search");t({type:C.SET_DETAILS,fromSearchForm:!0,alert:w,details:K(_)})}).catch(()=>{const _=h("Invalid search");t({type:C.SET_DETAILS,details:null,alert:_})})},[h]),p=q(d=>{(o?nr:er)(d).then(y=>{const z=!!(y!=null&&y.number)?void 0:h("Invalid order");t({type:C.SET_DETAILS,details:K(y),alert:z})}).catch(y=>{const w=h(y.message);if(!w){console.error(y),t({type:C.UNKNOWN_ERROR});return}t({type:C.ALERT,alert:w})})},[o,h]);return x(()=>{r&&(t({type:C.LOADING}),t({type:C.SET_DETAILS,details:r}))},[r]),x(()=>{r||!i.orderRef||o===void 0||(t({type:C.LOADING}),p(i.orderRef))},[o,p,r,i.orderRef]),x(()=>{i.details&&fr(i.details.email).then(d=>c(!d)).catch(()=>c(!0))},[i.details]),x(()=>{!i.details||u===void 0||t({type:C.DATA_FETCHED})},[u,i.details]),{state:i,authenticated:o,isEmailAssociatedWithAccount:u,handleOrderSearch:N,dismissAlert:v}}const Xr=({onSignUpClick:n,orderData:r,orderRef:i,routeHome:t,routeSupport:o})=>{const{state:a,authenticated:u,isEmailAssociatedWithAccount:c,handleOrderSearch:s,dismissAlert:h}=Hr({orderRef:i,orderData:r});if(u===void 0)return null;const N=n&&!u&&!a.isOrderFromSearchForm&&c===!1?()=>{if(!a.details)return;const g=a.details.shippingAddress,p=a.details.billingAddress,d=[{code:"firstname",defaultValue:(p==null?void 0:p.firstName)||""},{code:"lastname",defaultValue:(p==null?void 0:p.lastName)||""},{code:"email",defaultValue:a.details.email||""}];let _;if(g){const y={...G(g),default_shipping:!0};_=[{...G(p),default_billing:!0},y]}else _=[{...G(p),default_billing:!0,default_shipping:!0}];n({inputsDefaultValueSet:d,addressesData:_})}:void 0;return e(Or,{state:a,dismissAlert:h,onOrderSearch:s,routeHome:t,routeSupport:o,onSignUpClick:N})};export{Xr as OrderConfirmation,Xr as default};
>>>>>>> template/main
